var secondsToTime,snd;snd=window.SOUNDTEST=window.SOUNDTEST||{},snd.client_id="120a55b8b9d07b69a72faa9f4874f36d",snd.url="http://api.soundcloud.com/",snd.redirect_uri="http://soundcloud.billtrik.gr/callback.html",snd.hogan=Hogan,snd.timeoutVar=null,snd.db=snd.db||null,snd.db_prefix="SND_app_",snd.my_playlists=snd.Playlists(snd.db_prefix),snd.current_songs={},snd.nowPlaying={obj:null,element:null},snd.playlist_song_item_template=snd.hogan.compile('  <li class="song_item clearfix" data-id="{{id}}">    <div class="image_div">      <img src="{{artwork_url}}" />    </div>    <div class="details">      <h5>{{title}}</h5>      <p class="duration">{{duration}}</p>      <div class="buttons">        <button class="remove_me btn btn-danger" data-id="{{id}}">Remove Me</button>      </div>    </div>  </li>'),snd.song_in_playlist=snd.hogan.compile('  <li class="song_item clearfix" data-id="{{id}}">    <div class="image_div">      <img src="{{artwork_url}}" />    </div>    <div class="details">      <h5>{{title}}</h5>      <p class="current_time">00:00</p><span>/</span>      <p class="duration">{{duration}}</p>    </div>  </li>'),snd.song_item_template=snd.hogan.compile('  <li class="song_item clearfix" data-id="{{id}}">    <div class="image_div">      <img src="{{artwork_url}}" />    </div>    <div class="details">      <h5>{{title}}</h5>      <p class="current_time">00:00</p><span>/</span>      <p class="duration">{{duration}}</p>      <div class="buttons">        <button class="play_me btn btn-success" data-id="{{id}}">Play</button>        <button class="playlist_me btn btn-inverse" data-id="{{id}}">PlaylistMe</button>      </div>    </div>  </li>'),snd.playlist_new_template=snd.hogan.compile('  <li class="playlist_item" data-id="{{playlist_id}}">    <form class="new_playlist">      <div class="title_cont">        <input class="title" name="title" placeholder="Insert Title" value="{{title}}">      </div>      <div class="desc_cont">        <textarea class="desc" name="description" placeholder="Insert Description">{{description}}</textarea>      </div>      <div class="buttons">        <button class="btn btn-small btn-success create" type="submit">{{button_text}}</button>      </div>    </form>  </li>'),snd.playlist_item_template=snd.hogan.compile('  <li class="playlist_item" data-id="{{id}}">    <div class="title_cont">      <p class="title"><span>Title:</span>{{title}}</p>    </div>    <div class="desc_cont">      <p class="desc"><span>Description:</span>{{description}}</p>    </div>        <div class="buttons">      <button class="btn btn-small btn-info edit" >Edit It</button>      <button class="btn btn-small btn-danger delete" >Delete It</button>      <button class="btn btn-small show_songs" >Show Songs</button>      <button class="btn btn-small btn-success play_all">Play All</button>    </div>    <div class="songs_list">      <ul class="clearfix"></ul>    </div>  </li>'),snd.playlist_popup_template=snd.hogan.compile('  <li class="playlist_popup_item">    <button class="btn btn-primary add_here" data-id="{{id}}">{{title}}</button>  </li>'),snd.setHandlersForExistingPlaylistItem=function(a){var b,c,d,e,f,g,h;return c=a.find(".edit"),b=a.find(".delete"),h=a.find(".show_songs"),g=a.find(".play_all"),d=a.attr("data-id"),e=snd.my_playlists.list[d],f=a.find(".songs_list ul"),b.on("click",function(a){var b,c;return a.stop(),c=$(this).parents("li"),b=parseInt(c.attr("data-id"),10),snd.my_playlists.remove(b),c.remove(),!1}),c.on("click",function(a){var b,c,d,e,f;return a.stop(),d=$(this).parents("li"),c=parseInt(d.attr("data-id"),10),e=snd.my_playlists.get(c),e.button_text="Update It",b=$(snd.playlist_new_template.render(e)),delete e.button_text,snd.setHandlersForUpdatingPlaylistItem(b,e),(f=d.previous()).length===0?$("#playlists_list > ul").prepend(b):f.after(b),d.remove(),!1}),g.on("click",function(a){var b,c,d,f,g;a.stop(),f=$("#active_playlist_list ul"),f.empty(),g=e.songs_list;for(c in g)d=g[c],b=$(snd.song_in_playlist.render(d)),f.append(b);return $(".span12 .active").removeClass("active"),$(".navbar .nav .active").removeClass("active"),$("#active_playlist_list").addClass("active"),$("#active_playlist_button").parent().addClass("active"),$("#active_button_play").click(),!1}),h.on("click",function(b){var c,d,g,h;b.stop();if(a.find(".songs_list").hasClass("active")===!1){f.empty(),h=e.songs_list;for(d in h)g=h[d],c=$(snd.playlist_song_item_template.render(g)),c.find(".remove_me").on("click",function(a){var b,c;return a.stop(),c=$(this).attr("data-id"),b=$(this).parents(".playlist_item").attr("data-id"),snd.my_playlists.list[b].remove_song(c),$(this).parents(".song_item").remove(),!1}),snd.setHandlersForExistingPlaylistItem(c),f.append(c)}return a.find(".songs_list").toggleClass("active"),!1})},snd.setHandlersForUpdatingPlaylistItem=function(a,b){var c;return c=a.find(".create"),c.on("click",function(a){var c,d,e;return a.stop(),d=$(this).parents("li"),b.title=d.find(".title").val(),b.description=d.find(".desc").val(),snd.my_playlists.update(b),c=$(snd.playlist_item_template.render(b)),snd.setHandlersForExistingPlaylistItem(c),(e=d.previous()).length===0?$("#playlists_list > ul").prepend(c):e.after(c),d.remove(),!1})},snd.initialize_soundcloud=function(){SC.initialize({client_id:snd.client_id,redirect_uri:snd.redirect_uri})},snd.getTracks=function(){SC.get("/tracks",{limit:12},function(a){var b,c,d;for(c=0,d=a.length;c<d;c++)b=a[c],snd.current_songs[b.id]=b;snd.renderSongs(a),$("#songs_list img").hide()})},snd.renderSongs=function(a){var b,c,d,e,f;f=[];for(d=0,e=a.length;d<e;d++)c=a[d],c.duration=secondsToTime(c.duration),b=$(snd.song_item_template.render(c)),snd.setHandlersForNewMusicItem(b),f.push($("#songs_list ul").append(b));return f},snd.changeButtonToStop=function(a){if(a===void 0)return;a.removeClass("btn-success"),a.addClass("btn-danger"),a.html("Stop")},snd.changeButtonToPlay=function(a){if(a===void 0)return;a.parents("li").find(".current_time").html("00:00"),a.removeClass("btn-danger"),a.addClass("btn-success"),a.html("Play")},snd.timeoutfunc=function(){return snd.timeoutVar=setTimeout(function(){var a;if(snd.nowPlaying.li)return a=secondsToTime(snd.nowPlaying.obj.position),snd.nowPlaying.li.find(".current_time").html(a),snd.timeoutfunc()},1e3)},snd.playItemInPlaylist=function(a){SC.whenStreamingReady(function(){var b;b=SC.stream(a.id),snd.nowPlaying.obj=b,snd.nowPlaying.li=a.li,b.play({onplay:function(){return clearTimeout(snd.timeoutVar),snd.timeoutfunc()},onpause:function(){return console.log("onpause")},onstop:function(){return console.log("onstop"),clearTimeout(snd.timeoutVar)},onerror:function(){return console.log("error")},onfinish:function(){var b;return snd.nowPlaying.li.find(".current_time").html("00:00"),a.li.removeClass("nowplaying"),b=snd.nowPlaying.li.next(),b.length>0?(b.addClass("nowplaying"),snd.playItemInPlaylist({id:b.attr("data-id"),li:b})):(snd.nowPlaying.obj=null,snd.nowPlaying.li=null)}})})},snd.setHandlersForActivePlaylist=function(){$("#active_button_play").on("click",function(){var a,b;a=$("#active_playlist_list .song_item.nowplaying");if(a.length===1&&snd.nowPlaying.li)return!1;snd.nowPlaying.li&&(snd.nowPlaying.button&&snd.nowPlaying.button.length>0&&snd.changeButtonToPlay(snd.nowPlaying.button),snd.nowPlaying.obj.stop()),a.length===0&&(a=$("#active_playlist_list .song_item").first());if(a.length===0)return!1;a.addClass("nowplaying"),b=a.attr("data-id"),snd.playItemInPlaylist({id:b,li:a})}),$("#active_controls .prevnext").on("click",function(a){var b,c;a.preventDefault(),c=$(this).attr("id"),b=$("#active_playlist_list .song_item.nowplaying"),b.length===0&&(b=$("#active_playlist_list .song_item").first(),b.addClass("nowplaying"));if(b.length===0)return!1;if(c==="active_button_prev"){if(b.previous().length===0)return!1}else if(b.next().length===0)return!1;b.find(".current_time").html("00:00"),b.removeClass("nowplaying"),c==="active_button_prev"?b=b.previous():b=b.next(),b.addClass("nowplaying");if(snd.nowPlaying.li)return snd.nowPlaying.button&&snd.nowPlaying.button.length>0&&snd.changeButtonToPlay(snd.nowPlaying.button),snd.nowPlaying.obj.stop(),c=b.attr("data-id"),snd.playItemInPlaylist({id:c,li:b})}),$("#active_button_stop").on("click",function(){var a;return a=$("#active_playlist_list .song_item.nowplaying"),a.length===0?!1:(snd.nowPlaying.li&&(snd.nowPlaying.button&&snd.nowPlaying.button.length>0&&snd.changeButtonToPlay(snd.nowPlaying.button),snd.nowPlaying.obj.stop()),a.find(".current_time").html("00:00"),a.removeClass("nowplaying"),snd.nowPlaying.obj=null,snd.nowPlaying.li=null,snd.nowPlaying.obj=null)})},snd.setHandlersForNewMusicItem=function(a){var b;b=a.attr("data-id"),a.find(".play_me").on("click",function(){var a,b;if(snd.nowPlaying.li){snd.changeButtonToPlay(snd.nowPlaying.button),snd.nowPlaying.obj.stop();if(snd.nowPlaying.button&&snd.nowPlaying.button[0]===this)return snd.nowPlaying.li=null,snd.nowPlaying.button=null,snd.nowPlaying.obj=null,!0}a=$(this),snd.changeButtonToStop(a),b=parseInt(a.attr("data-id"),10),SC.whenStreamingReady(function(){var c;return c=SC.stream(b),snd.nowPlaying.obj=c,snd.nowPlaying.li=a.parents("li"),snd.nowPlaying.button=a,c.play({onplay:function(){return snd.timeoutfunc()},onpause:function(){},onstop:function(){return clearTimeout(snd.timeoutVar),snd.changeButtonToPlay(snd.nowPlaying.button)},onfinish:function(){return snd.changeButtonToPlay(snd.nowPlaying.button),snd.nowPlaying.li.find(".current_time").html("00:00"),snd.nowPlaying.li=null,snd.nowPlaying.button=null,snd.nowPlaying.obj=null}})})}),a.find(".playlist_me").on("click",function(){var a,c,d,e,f,g,h;$("#playlists_popup").show("block"),d=$("#playlists_popup ul"),d.empty(),g=snd.my_playlists.list,h=[];for(e=0,f=g.length;e<f;e++)c=g[e],c.active===!0?(a=$(snd.playlist_popup_template.render(c)),snd.setHandlersPlaylistPopupItem(a,b),h.push(d.append(a))):h.push(void 0);return h})},snd.setHandlersPlaylistPopupItem=function(a,b){a.find(".add_here").on("click",function(){var a,c;return a=parseInt($(this).attr("data-id"),10),c=b,snd.my_playlists.list[a].add_song(snd.current_songs[c]),$("#playlists_popup").hide()})},snd.printExistingPlaylists=function(){var a,b,c,d;d=snd.my_playlists.list;for(b in d)c=d[b],c.active===!0&&(a=$(snd.playlist_item_template.render(c)),snd.setHandlersForExistingPlaylistItem(a),$("#playlists_list > ul").prepend(a))},snd.setHandlersForNewPlaylistItem=function(a){var b;return b=a.find(".create"),b.on("click",function(a){var b,c,d,e,f;return a.stop(),d=$(this).parents("li"),e=d.find(".title").val(),c=d.find(".desc").val(),f=snd.my_playlists.create({title:e,description:c}),d.remove(),b=$(snd.playlist_item_template.render(f)),snd.setHandlersForExistingPlaylistItem(b),$("#playlists_list > ul").prepend(b),!1})},$.domReady(function(){return $(".navbar .btn-navbar").on("click",function(){return $(".navbar").toggleClass("active")}),$(".navbar .nav li a").on("click",function(a){var b;return a.stop(),b=$("#"+$(this).attr("data-target")),$(".navbar .nav li.active").removeClass("active"),$(this).parent().addClass("active"),$(".content_div.active").removeClass("active"),b.addClass("active"),$(".navbar").removeClass("active"),!1}),$("#create_playlist_button").on("click",function(){var a;return a=$(snd.playlist_new_template.render({button_text:"Create It"})),snd.setHandlersForNewPlaylistItem(a),$("#playlists_list > ul").prepend(a)}),$("#close_me").click(function(a){return a.stop(),$("#playlists_popup").hide(),!1}),snd.initialize_soundcloud(),SC.whenStreamingReady(function(){}),snd.getTracks(),snd.printExistingPlaylists(),snd.setHandlersForActivePlaylist()}),secondsToTime=function(a){var b,c,d,e,f;return a/=1e3,d=Math.floor(a/3600),d<10&&(d="0"+d),b=a%3600,e=Math.floor(b/60),e<10&&(e="0"+e),c=b%60,f=Math.ceil(c),f<10&&(f="0"+f),e+":"+f};